<!DOCTYPE html>
<html lang="en">
  <head>
    <title> Synthesize random numbers into sound</title>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script>
      $( function() {
        $( "#slider-range" ).slider({
          range: true,
          min: 24,
          max: 120,
          values: [ 36, 72 ],
          slide: function( event, ui ) {
            $( "#midi_range_string" ).val( ui.values[ 0 ] + " - " + ui.values[ 1 ] );        
            $( "#midi_min_string" ).val( ui.values[ 0 ]);
            $( "#midi_max_string" ).val( ui.values[ 1 ]);
          }
        });
      });
    </script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="./main.js"></script>
    <p>
      <label for="midi_range_string">Midi note range:</label>
      <input type="text" id="midi_range_string" readonly style="border:0; color:#f6931f; font-weight:bold;">
    </p>
     
    <input type="text"  value="36" id="midi_min_string">
<input type="text" value="72" id="midi_max_string">
<div id="slider-range"></div>
    <input id="n_curves" type="number" value="5" min="1" max="50">number of random curves</input>
    <input id="n_timesteps" type="number" value="30" min="1" max="1000">number of time steps</input>
    <input id="note_dur" type="number" value="0.5" min="0.1" max="10">note duration (in s)</input>
  
      <fieldset id="scale_notes">
      <legend>Choose scale notes</legend>
      <div>
          <input type="checkbox" id="C" name="C" value=0 checked />
          <label for="">C</label>
      </div>
      <div>
          <input type="checkbox" id="C#" name="C#" value=1 />
          <label for="C#">C#</label>
      </div>
      <div>
          <input type="checkbox" id="D" name="D" value=2 checked />
          <label for="D">D</label>
      </div>
      <div>
          <input type="checkbox" id="D#" name="D#" value=3 />
          <label for="D#">D#</label>
      </div>
      <div>
          <input type="checkbox" id="E" name="E" value=4 checked />
          <label for="E">E</label>
      </div>
      <div>
          <input type="checkbox" id="F" name="F" value=5 checked />
          <label for="F">F</label>
      </div>
      <div>
          <input type="checkbox" id="F#" name="F#" value=6 />
          <label for="F#">F#</label>
      </div>
      <div>
          <input type="checkbox" id="G" name="G" value=7 checked />
          <label for="G">G</label>
      </div>
      <div>
          <input type="checkbox" id="G#" name="G#" value=8 />
          <label for="G#">G#</label>
      </div>
      <div>
          <input type="checkbox" id="A" name="A" value=9 checked />
          <label for="A">A</label>
      </div>
      <div>
          <input type="checkbox" id="A#" name="A#" value=10 />
          <label for="A#">A#</label>
      </div>
      <div>
          <input type="checkbox" id="B" name="B" value=11 checked />
          <label for="B">B</label>
      </div>
  </fieldset>

  <button name="gen-random-curves-button" id="gen-random-curves-button">Click to generate random curves with these parameters</button>
  
  <div id="stepPlot"></div>
  <button name="plot-and-play-button" id="plot-and-play-button">ðŸ”Š Play ðŸ”Š</button>
  <br>
  <a href="https://github.com/urswilke/chaos_synthetization">Source code</a>
  

  <p>
    <label><strong>Curve parameters</strong></label>
    <label><input name="n_curves_input" type="number" value="5" placeholder="Enter number of curves (will delete all previous entries!)" /></label>
<div class="clear"></div>
</p>

<button name="gen_para_tbl" id="gen_para_tbl">Generate parameter table for chosen no of curves</button>
<p id="p_root_notes"></p>
<p id="p_random_amplitudes"></p>
<p id="p_note_checks"></p>

<div class="curve_params_div">
    <table id="curve_params_tbl" width="630" border="0">
        <tr>
            <td>midi</td>
            <!-- <td width="20">Sex</td> -->
            <td>random amplitude</td>
            <td>C</td>
            <td>C#</td>
            <td>D</td>
            <td>D#</td>
            <td>E</td>
            <td>F</td>
            <td>F#</td>
            <td>G</td>
            <td>G#</td>
            <td>A</td>
            <td>A#</td>
            <td>B</td>
        </tr>
    </table>
</div>

<div class="template" style="display: none">
    <table>
        <tr class="i_curve_params">
            <td><input class="root_note" name="root_note" value="1" type="number" placeholder="Name"
                    required="required" /></td>
            <!-- <td>
                 <select name="cand_sex" required="required">
                    <option value=" "> </option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                 </select>
              </td> -->
              <td><input class="random_amplitude" name="random_amplitude" value="1" type="number" step="any" placeholder="Email" required="required" /></td>
                <td><input type="checkbox" class="note_check" id="C" name="C" value=0 checked></td>
                <td><input type="checkbox" class="note_check" id="C#" name="C#" value=1></td>
                <td><input type="checkbox" class="note_check" id="D" name="D" value=2 checked></td>
                <td><input type="checkbox" class="note_check" id="D#" name="D#" value=3></td>
                <td><input type="checkbox" class="note_check" id="E" name="E" value=4 checked></td>
                <td><input type="checkbox" class="note_check" id="F" name="F" value=5 checked></td>
                <td><input type="checkbox" class="note_check" id="F#" name="F#" value=6></td>
                <td><input type="checkbox" class="note_check" id="G" name="G" value=7 checked></td>
                <td><input type="checkbox" class="note_check" id="G#" name="G#" value=8></td>
                <td><input type="checkbox" class="note_check" id="A" name="A" value=9 checked></td>
                <td><input type="checkbox" class="note_check" id="A#" name="A#" value=10></td>
                <td><input type="checkbox" class="note_check" id="B" name="B" value=11 checked></td>
        </tr>
    </table>
</div>
<!-- <script src="jquery_functions.js"></script> -->
<script>
  $('[name="n_curves_input"]').on('change', function () {
      // Not checking for Invalid input
      if (this.value != '') {
          var val = parseInt(this.value, 10);

          $('#curve_params_tbl tbody').find("tr:gt(0)").remove();
          for (var i = 0; i < val; i++) {
              // Clone the Template
              var $cloned = $('.template tbody').clone();
              // For each Candidate append the template row
              $('#curve_params_tbl tbody').append($cloned.html());
          }
      }
  })
      // this also fires the function when ready in the beginning:
      // (see here: https://stackoverflow.com/a/17247289)
      .change();

  function get_inputs() {
      var countr = 0;
      var root_notes = new Array();
      var random_amplitudes = new Array();
      var note_checks = new Array();
      $("tr.i_curve_params").not(".template tr.i_curve_params").each(function () {
          aa = $(this);
          root_notes[countr] = Number(aa.find("input.root_note").val());
          random_amplitudes[countr] = Number(aa.find("input.random_amplitude").val());
          note_checks[countr] = aa
              .find("input.note_check")
              .filter(function () { return this.checked; })
              .map(function () { return this.value; })
              .get()
              .map(Number);
          countr += 1;
      });
      document.getElementById("p_root_notes").innerHTML = root_notes;
      document.getElementById("p_random_amplitudes").innerHTML = random_amplitudes;
      document.getElementById("p_note_checks").innerHTML = note_checks;
      // console.log(root_notes)
      // return note_checks;
  }
  function rand_root_notes() {
  let items = getAllScaleNotes([0, 7], 36, 84, rootNote = 60);
  // https://stackoverflow.com/a/5915122
  return items[Math.floor(Math.random() * items.length)];
}
function getAllScaleNotes(steps, midi_min, midi_max, rootNote = 60) {

let rootNoteMin = rootNote % 12;
let i = rootNoteMin;
let i2 = 0;
let x = [];
// from here: https://stackoverflow.com/a/50672288
let repeatedArray = [].concat(...Array(11).fill(steps));
let octaveArray = [];
for (let i = 0; i < repeatedArray.length; i++) {
  let octave = Math.floor(i / steps.length)
  octaveArray[i] = repeatedArray[i] + octave * 12;
  
}
return octaveArray
  .filter(num => num >= midi_min & num <= midi_max);
  
}
function set_inputs() {
  var countr = 0;
  var root_notes = new Array();
  var random_amplitudes = new Array();
  // var note_checks = new Array();
  $("tr.i_curve_params").not(".template tr.i_curve_params").each(function () {
      aa = $(this);
      let r = rand_root_notes();
      root_notes[countr] = Number(aa.find("input.root_note").val(r));
      random_amplitudes[countr] = Number(aa.find("input.random_amplitude").val(Math.floor(r/3)));
      // note_checks[countr] = aa
      //     .find("input.note_check")
      //     .filter(function() {return this.checked;})
      //     .map(function() {return this.value;})
      //     .get()
      //     .map(Number);
      countr += 1;
  });
  // document.getElementById("p_root_notes").innerHTML = root_notes;
  // document.getElementById("p_random_amplitudes").innerHTML = random_amplitudes;
  // document.getElementById("p_note_checks").innerHTML = note_checks;
  // console.log(root_notes)
  // return note_checks;
}

    document.getElementById("gen_para_tbl").addEventListener('click', set_inputs);
</script>


  </body>
</html>
